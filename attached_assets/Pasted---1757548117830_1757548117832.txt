# הנחיה מפורטת להוספת מודול אומדן אנלוגי מתקדם

## רקע והקשר
אני פיתחתי מערכת לחישוב אומדני עלות רכש ב-Replit. המערכת עובדת עם תור דרישות רכש, כאשר משתמשים בוחרים דרישה מהתור ובוחרים שיטת אומדן על פי המלצות AI. כשנבחרת שיטת "אומדן אנלוגי", נפתח מסך יצירת אומדן ספציפי. אני רוצה שתשדרג את המודול הזה להיות חכם ומדויק יותר.

## מה צריך להוסיף למערכת

### חלק א: שדרוג מנוע החישוב הבסיסי

במקום לעשות חישוב פשוט של ממוצע מחירים היסטוריים, המערכת צריכה:

1. **לנתח את הנתונים ההיסטוריים בצורה חכמה יותר** - לא רק ממוצע אלא גם מגמות, עונתיות וחריגות
2. **לזהות אוטומטית את קטגוריית הרכש** מתוך תיאור הדרישה ולהשתמש בפרמטרים מותאמים לכל קטגוריה
3. **לטעון נתונים רלוונטיים בלבד** - לא כל ההיסטוריה אלא רק רכישות דומות
4. **לחשב טווחי אמינות** על בסיס הסטייה ההיסטורית

### חלק ב: הוספת מקדמי התאמה

המערכת צריכה לאפשר התאמה של המחיר הבסיסי באמצעות מקדמים שונים:

#### מקדמי זמן:
- **אינפלציה**: לחשב השפעת אינפלציה מהתקופה ההיסטורית למועד הרכישה המתוכנן
- **עונתיות**: לזהות אם יש עונתיות במחירים ולהתאים בהתאם לחודש המתוכנן
- **מגמות שוק**: לזהות אם יש מגמת עלייה או ירידה במחירים

#### מקדמי כמות:
- לחשב אם הכמות הנדרשת שונה מהכמות הממוצעת ההיסטורית
- לתת הנחות לכמויות גדולות או תוספות לכמויות קטנות
- לאפשר למשתמש להגדיר מקדמי חסכון לקטגוריות שונות

#### מקדמי איכות ומפרט:
- לאפשר למשתמש לציין אם המפרט שונה מההיסטורי
- לתת אפשרות להוסיף תוספות למפרטים מתקדמים
- להשוות בין יצרנים או דגמים שונים

#### מקדמי שוק:
- להתחשב במצב התחרות בשוק
- לזהות מחסור או שפע בחומרי גלם
- לאפשר למשתמש להוסיף התאמות ידניות

### חלק ג: מסך יצירת האומדן

כשמשתמש בוחר דרישה ובוחר באומדן אנלוגי, המסך צריך להציג:

#### אזור פרטי הדרישה (לא ניתן לעריכה):
- מזהה הדרישה, תיאור, כמות, מועד נדרש
- קטגוריה שזוהתה אוטומטית
- כפתור לעריכת הקטגוריה אם הזיהוי שגוי

#### אזור נתונים היסטוריים:
- רשימה של הרכישות הדומות שנמצאו
- ממוצע מחיר ליחידה לכל שנה
- המחיר הבסיסי המחושב
- אינדיקטור לאיכות הנתונים (מעט/בינוני/הרבה נתונים)

#### אזור מקדמי התאמה:
- שדות עריכה לכל סוג מקדם
- ערכי ברירת מחדל שהמערכת מציעה
- הסבר קצר ליד כל מקדם
- חישוב בזמן אמת של ההשפעה על המחיר

#### אזור תוצאות:
- הצגה חיה של החישוב השלב אחר שלב
- המחיר הסופי
- טווח אמינות
- השוואה למחיר הבסיסי (כמה אחוזים הפרש)

### חלק ד: מודול ניתוח רגישות

הוסף טאבים נוספים למסך שמציגים:

#### טאב ניתוח גורמים בודדים:
- טבלה שמראה מה קורה אם כל מקדם משתנה בפלוס או מינוס 10 אחוז
- סימון צבעוני לגורמים שמשפיעים הכי הרבה (אדום) לעומת פחות (ירוק)
- מיון הגורמים לפי רמת ההשפעה

#### טאב תרחישים:
- תרחיש אופטימי: כל הגורמים בכיוון הטוב ביותר
- תרחיש פסימי: כל הגורמים בכיוון הרע ביותר  
- תרחיש מעורב: שילוב סביר של גורמים חיוביים ושליליים
- עבור כל תרחיש: המחיר הצפוי והאחוז הפרש מהבסיס

#### טאב מטריצת רגישות:
- טבלה דו-ממדית שמציגה השפעה של שני גורמים מרכזיים יחד
- למשל: אינפלציה בציר האנכי, הנחת כמות בציר האופקי
- בכל תא של הטבלה: המחיר הצפוי בשילוב הזה

### חלק ה: תכונות נוספות

#### התראות ואינדיקטורים:
- הודעות אזהרה אם הנתונים ההיסטוריים מוגבלים
- זיהוי שינויים טכנולוגיים שעלולים להשפיע על הרלוונטיות
- התראה על תנודתיות גבוהה במחירים לאחרונה

#### תובנות וזיהוי דפוסים:
- זיהוי מגמות עונתיות אוטומטיות
- הצעת מועדי רכישה אופטימליים
- זיהוי הזדמנויות חיסכון

#### שמירה וייצוא:
- שמירת האומדן במסד הנתונים עם כל הפרמטרים
- יצירת דוח PDF עם הפירוט המלא
- הכנת סיכום להעתקה למייל או למצגת

#### דוח מפורט אוטומטי:
- יצירה אוטומטית של דוח שכולל את כל הנתונים
- הסבר של הבסיס לחישוב
- פירוט של כל המקדמים ששימשו
- המלצות למשך ביטחון ולניהול סיכונים

### חלק ו: אינטגרציה עם המערכת הקיימת

#### חיבור לתור דרישות:
- המודול צריך לקבל את מזהה הדרישה מהתור
- לטעון את פרטי הדרישה מהמסד נתונים
- לשמור את תוצאות האומדן בקשר לדרישה המקורית

#### חיבור למסד נתונים ההיסטוריים:
- גישה לטבלת רכישות עבר
- סינון יעיל של נתונים רלוונטיים
- שמירת הגדרות מקדמים לשימוש עתידי

#### חיבור למערכת ההמלצות:
- שימוש בהמלצות AI לקביעת ערכי ברירת מחדל
- עדכון מודל ההמלצות על בסיס תוצאות בפועל

### חלק ז: חוויית משתמש

#### עיצוב ממשק:
- מסך נקי ומסודר עם חלוקה ברורה לאזורים
- עדכון בזמן אמת של התוצאות כשמשנים פרמטרים
- אינדיקטורים ויזואליים לאמינות וודאות
- כפתורים ברורים לפעולות שונות

#### הדרכה ועזרה:
- טיפים מובנים ליד כל שדה
- הסברים על המשמעות של כל מקדם
- דוגמאות למתי כדאי להשתמש בערכים שונים
- קישור לעזרה מפורטה או מדריך משתמש

## דוגמה מעשית לממשק המוצע

### אזור פרטי הדרישה:
```
מזהה דרישה: #RQ-2025-001
תיאור: רכישת 10 מחשבים ניידים לחטיבת הפיתוח
קטגוריה: ציוד מחשוב [זוהה אוטומטית] [עריכה]
כמות: 10 יחידות
דרישת מועד: 15/03/2025
```

### אזור נתונים היסטוריים:
```
נמצאו נתונים היסטוריים מ-5 השנים האחרונות:
✓ 2020: 8 מחשבים - ממוצע ₪4,000/יחידה
✓ 2021: 12 מחשבים - ממוצע ₪3,800/יחידה  
✓ 2022: 6 מחשבים - ממוצע ₪4,300/יחידה
✓ 2023: 15 מחשבים - ממוצע ₪3,500/יחידה
✓ 2024: 10 מחשבים - ממוצע ₪4,200/יחידה

מחיר בסיס מחושב: ₪3,960/יחידה
איכות נתונים: גבוהה [51 נקודות נתונים]
```

### אזור מקדמי התאמה:
```
🔧 הגדרות מקדמי התאמה:

┌─ גורמי זמן ────────────────────────────────────┐
│ שיעור אינפלציה: [3.0%] (עריכה)                │
│ עונתיות לרכישה במרץ: [-2%] (זוהה אוטומטית)    │
│ מגמת מחירים: [יציב] (על בסיס ניתוח היסטורי)   │
└────────────────────────────────────────────────┘

┌─ גורם כמות ────────────────────────────────────┐
│ כמות נדרשת: 10 vs ממוצע היסטורי: 10.2         │
│ מקדם סקאלה: [ללא שינוי] (עריכה)               │
│ הנחת כמות צפויה: [0%] (עריכה)                 │
└────────────────────────────────────────────────┘

┌─ גורמי איכות ומפרט ──────────────────────────────┐
│ רמת מפרט: [רגיל] ▼ (בסיסי/רגיל/מתקדם/פרמיום) │
│ שדרוגי חובה: [₪0] (עריכה)                     │
│ יצרן מועדף: [ללא העדפה] (עריכה)               │
└────────────────────────────────────────────────┘

┌─ גורמי שוק ──────────────────────────────────────┐
│ מצב שוק נוכחי: [רגיל] ▼ (תחרותי/רגיל/מחסור)   │
│ תנאי ספקים: [סטנדרטי] (עריכה)                 │
│ התאמות ידניות: [+₪0] (עריכה)                  │
└────────────────────────────────────────────────┘
```

### אזור תוצאות:
```
💰 תוצאות אומדן:

מחיר בסיס: ₪39,600 (₪3,960 × 10)
+ אינפלציה (3%): +₪1,188
- עונתיות (מרץ): -₪792
+ מפרט רגיל: +₪0
+ התאמות ידניות: +₪0
─────────────────────────────
אומדן סופי: ₪39,996

טווח אמינות (90%): ₪35,996 - ₪43,996
הפרש מבסיס: +1% (₪396)
```

### טאב ניתוח רגישות - גורמים בודדים:
```
📊 ניתוח רגישות - גורמים בודדים:

גורם               | שינוי ±10% | השפעה על עלות | רמת רגישות
──────────────────|──────────--|──────────────|─────────────
אינפלציה          | ±₪400     | גבוהה        | 🔴
מפרט              | ±₪600     | גבוהה        | 🔴
גורם כמות         | ±₪200     | בינונית      | 🟡  
עונתיות           | ±₪80      | נמוכה        | 🟢
התאמות ידניות     | ±₪100     | נמוכה        | 🟢
```

### טאב תרחישים:
```
🎯 ניתוח תרחישים:

תרחיש אופטימי:
├─ אינפלציה נמוכה (2%)
├─ הנחת כמות (5%)  
├─ עונתיות טובה (נובמבר)
├─ מפרט בסיסי
└─ עלות צפויה: ₪36,400 (-9%)

תרחיש סביר:
├─ אינפלציה כצפוי (3%)
├─ מפרט רגיל
├─ עונתיות במרץ
└─ עלות צפויה: ₪39,996 (בסיס)

תרחיש פסימי:
├─ אינפלציה גבוהה (5%)
├─ מחסור בשוק (+10%)
├─ שדרוג מפרט נדרש (+15%)
├─ עונתיות רעה
└─ עלות צפויה: ₪48,500 (+21%)
```

### טאב מטריצת רגישות:
```
🎛️ מטריצת רגישות - אינפלציה vs הנחת כמות:

אינפ\הנחה    0%      3%      5%      8%
───────────────────────────────────────
    2%     39,200  38,024  37,240  36,064
    3%     39,996  38,796  37,996  36,796  ← בסיס
    4%     40,796  39,572  38,756  37,532
    5%     41,600  40,352  39,520  38,272
```

### התראות ותובנות:
```
⚠️ התראות:
• תנודתיות גבוהה במחירים ב-6 חודשים אחרונים (+15%)
• שינוי טכנולוגי משמעותי מזוהה (DDR4→DDR5)

💡 תובנות AI:
• מחירי מחשבים צפויים לרדת ב-5% ברבעון הבא
• מומלץ לבדוק חלופות לדגמים עסקיים
• ספק מועדף זמין עם הנחה של 8% לכמות זו
• רכישה בנובמבר-דצמבר יכולה לחסוך 3-7%
```

### כפתורי פעולה:
```
[שמור אומדן]  [שמור כטיוטה]  [שתף לביקורת]  [חזור לתור]

[↗️ יצוא ל-Excel]  [📋 העתק סיכום]  [📊 הצג דוח מפורט]
```

## סיכום יעדי הפיתוח

המטרה היא ליצור כלי שחכם ומדויק למשתמשים מקצועיים, אבל בו זמנית קל לשימוש וברור אפילו למי שלא מומחה בתחום. הכלי צריך:

1. **להיות מדויק** - לקחת בחשבון גורמים רבים המשפיעים על מחירים
2. **להיות שקוף** - המשתמש רואה איך מחושב כל דבר
3. **להיות גמיש** - אפשרות להתאים פרמטרים לצרכים ספציפיים
4. **להיות חכם** - להציע ערכי ברירת מחדל סבירים ולזהות דפוסים
5. **להיות מועיל** - לא רק לתת מחיר אלא גם תובנות והמלצות

המודול הזה יהיה הבסיס לקבלת החלטות מושכלות ברכש ויעזור לצמצם סיכונים ולמצוא הזדמנויות חיסכון.